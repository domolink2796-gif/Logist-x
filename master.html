<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LOGIST_MASTER | HQ</title>
    
    <!-- PWA –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç–∏ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#010409">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/1162/1162456.png">
    <link rel="manifest" href='data:application/json,{"name":"Logist Master","short_name":"Master","start_url":"./master.html","display":"standalone","background_color":"#010409","theme_color":"#f59e0b","icons":[{"src":"https://cdn-icons-png.flaticon.com/512/1162/1162456.png","sizes":"512x512","type":"image/png"}]}'>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { background: #010409; color: #e6edf3; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; padding-top: env(safe-area-inset-top); }
        .glass { background: rgba(13, 17, 23, 0.9); backdrop-filter: blur(20px); border: 1px solid #30363d; border-radius: 28px; }
        .btn-gold { background: linear-gradient(135deg, #f59e0b, #b45309); color: #000; font-weight: 900; transition: 0.2s; }
        .btn-gold:active { transform: scale(0.96); }
        .input-dark { background: #000; border: 1px solid #30363d; color: #fff; outline: none; transition: 0.3s; }
        .input-dark:focus { border-color: #f59e0b; }
        .modal-overlay { background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 1000; }
        ::-webkit-scrollbar { width: 0px; }
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
    const { useState, useEffect } = React;

    const App = () => {
        const [projects, setProjects] = useState(() => {
            const saved = localStorage.getItem('master_projects_v14');
            return saved ? JSON.parse(saved) : [
                { name: "–û—Å–Ω–æ–≤–Ω–æ–π –®—Ç–∞–±", url: "https://script.google.com/macros/s/AKfycbz3ZscxDR4Ls4383w43ENWJnov5SEunvNhG_mUSzZTuawytVg2Pwn67VyOgwJ5f2FfA8A/exec", techPass: "–ï–≤–≥–µ–Ω–∏–π –ù–∏–∫–∏—Ç–∏–Ω" }
            ];
        });

        const [activeIdx, setActiveIdx] = useState(0);
        const [isAuth, setIsAuth] = useState(false);
        const [passInput, setPassInput] = useState("");
        const [keys, setKeys] = useState([]);
        const [loading, setLoading] = useState(false);
        const [showProjects, setShowProjects] = useState(false);
        const [showGen, setShowGen] = useState(false);
        
        const [genUrl, setGenUrl] = useState("");
        const [genPass, setGenPass] = useState("Elite" + Math.floor(Math.random()*900 + 100));
        const [genResult, setGenResult] = useState("");

        const cur = projects[activeIdx];

        useEffect(() => {
            localStorage.setItem('master_projects_v14', JSON.stringify(projects));
            if (window.lucide) window.lucide.createIcons();
        }, [projects, isAuth, showGen, showProjects]);

        const checkLogin = () => {
            if (passInput.trim().toLowerCase() === '–µ–≤–≥–µ–Ω–∏–π –Ω–∏–∫–∏—Ç–∏–Ω') setIsAuth(true);
            else alert("–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω!");
        };

        const sync = async () => {
            if (!cur?.url) return;
            setLoading(true);
            try {
                const res = await fetch(cur.url, { 
                    method: 'POST', 
                    body: JSON.stringify({action:'list_keys', adminPass: cur.techPass}) 
                });
                const data = await res.json();
                setKeys(data.keys || []);
            } catch(e) { alert("–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å Google."); }
            finally { setLoading(false); }
        };

        const createAcc = async (e) => {
            e.preventDefault();
            const fd = new FormData(e.target);
            setLoading(true);
            try {
                const res = await fetch(cur.url, { 
                    method: 'POST', 
                    body: JSON.stringify({
                        action: 'add_key', 
                        adminPass: cur.techPass,
                        workerName: fd.get('w'),
                        clientName: fd.get('o'),
                        days: fd.get('d')
                    })
                });
                const r = await res.json();
                if (r.status === 'success') { sync(); e.target.reset(); alert("–õ–∏—Ü–µ–Ω–∑–∏—è —Å–æ–∑–¥–∞–Ω–∞!"); }
            } finally { setLoading(false); }
        };

        const copyInvite = (k, w) => {
            const msg = `üöÄ LOGIST_X ACCESS\nüë§ –í–æ—Ä–∫–µ—Ä: ${w}\nüîë –ö–æ–¥: ${k}\nüåê –®—Ç–∞–±: ${cur.url}\nüì± App: https://${window.location.hostname}/app/`;
            const el = document.createElement('textarea');
            el.value = msg;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);
            alert("–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
        };

        const generateRobotCode = () => {
            let id = genUrl;
            if(id.includes('/d/')) id = id.split('/d/')[1].split('/')[0];
            if(!id || id.length < 20) return alert("–ù–µ–≤–µ—Ä–Ω—ã–π URL —Ç–∞–±–ª–∏—Ü—ã");
            
            const code = `/**\n * LOGIST_X ROBOT v14\n * SS_ID: ${id}\n */\nconst SS_ID = "${id}";\nconst ADMIN_PASS = "${genPass}";\n\nfunction doPost(e) { /* ... –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –†–æ–±–æ—Ç–∞ v14 ... */ }`;
            setGenResult(code);
        };

        useEffect(() => { if(isAuth) sync(); }, [isAuth, activeIdx]);

        if(!isAuth) {
            return (
                <div className="h-screen flex items-center justify-center p-6 bg-[#010409]">
                    <div className="glass p-12 w-full max-w-sm text-center shadow-2xl border-t-2 border-amber-500/20">
                        <div className="w-20 h-20 bg-amber-500 rounded-[2rem] flex items-center justify-center mx-auto mb-8 text-black shadow-lg shadow-amber-500/20">
                            <i data-lucide="shield-check" size={32}></i>
                        </div>
                        <h1 className="text-xl font-black mb-8 uppercase tracking-[0.2em] italic">Master HQ</h1>
                        <input type="password" value={passInput} onChange={e=>setPassInput(e.target.value)} placeholder="Master Password" class="input-dark w-full p-4 rounded-2xl mb-4 text-center font-bold" onKeyDown={e=>e.key==='Enter'&&checkLogin()} />
                        <button onClick={checkLogin} className="btn-gold w-full py-5 rounded-2xl uppercase text-[10px] tracking-widest">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</button>
                    </div>
                </div>
            );
        }

        return (
            <div className="p-4 md:p-10 max-w-6xl mx-auto min-h-screen">
                <header className="flex justify-between items-center mb-8 bg-[#0d1117] p-5 rounded-[2rem] border border-white/5">
                    <div className="flex items-center gap-3">
                        <div className="w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center text-black shadow-lg shadow-amber-500/10">
                            <i data-lucide="zap" size={20} fill="currentColor"></i>
                        </div>
                        <div>
                            <h1 className="text-xl font-black italic text-amber-500 uppercase leading-none tracking-tighter">Logist Master</h1>
                            <p className="text-[9px] opacity-30 mt-1 font-bold uppercase tracking-[3px]">{cur.name}</p>
                        </div>
                    </div>
                    <div className="flex gap-2">
                        <button onClick={()=>setShowProjects(true)} className="p-4 glass rounded-2xl border-white/10 hover:bg-white/5 transition-all">
                            <i data-lucide="settings" size={20}></i>
                        </button>
                        <button onClick={sync} className="p-4 btn-gold rounded-2xl shadow-lg shadow-amber-500/10 active:scale-95 transition-all">
                            <i data-lucide="refresh-cw" size={20} className={loading?'animate-spin':''}></i>
                        </button>
                    </div>
                </header>

                <div className="grid grid-cols-1 lg:grid-cols-3 gap-8 items-start">
                    <div className="lg:col-span-2 space-y-4">
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {keys.map(k => (
                                <div key={k.key} className="glass p-6 hover:border-amber-500/40 transition-all group relative overflow-hidden">
                                    <div className="flex justify-between mb-6">
                                        <div className="text-amber-500 font-mono font-black text-base tracking-widest">{k.key}</div>
                                        <div className="flex gap-3">
                                            <a href={`https://drive.google.com/drive/folders/${k.folder}`} target="_blank" className="p-2 bg-white/5 rounded-lg opacity-40 hover:opacity-100 hover:text-amber-500 transition-all">
                                                <i data-lucide="folder-open" size={18}></i>
                                            </a>
                                        </div>
                                    </div>
                                    <div className="text-white font-black uppercase truncate mb-1 text-xl leading-none">{k.worker || "–û–∂–∏–¥–∞–µ—Ç –≤—Ö–æ–¥–∞"}</div>
                                    <div className="text-[10px] opacity-40 uppercase font-bold italic mb-8 tracking-widest">{k.name}</div>
                                    
                                    <button onClick={()=>copyInvite(k.key, k.worker)} className="w-full py-4 bg-amber-500 text-black rounded-2xl text-[10px] font-black uppercase flex items-center justify-center gap-2 hover:scale-[1.02] active:scale-95 transition-all">
                                        <i data-lucide="copy" size={14}/> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø
                                    </button>
                                </div>
                            ))}
                        </div>
                        {keys.length === 0 && !loading && (
                            <div className="text-center py-20 opacity-10 font-black uppercase tracking-[10px]">–ë–∞–∑–∞ –ø—É—Å—Ç–∞</div>
                        )}
                    </div>

                    <div className="lg:sticky lg:top-10">
                        <form onSubmit={createAcc} className="glass p-10 space-y-6 border-t-4 border-amber-500 shadow-2xl bg-[#0d1117]">
                            <h2 className="text-center font-black uppercase text-[11px] tracking-[4px] italic text-amber-500 mb-2">–ù–æ–≤–∞—è –õ–∏—Ü–µ–Ω–∑–∏—è</h2>
                            <div className="space-y-4">
                                <input name="w" placeholder="–§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞" required className="input-dark w-full p-4 rounded-xl font-bold border-white/5" />
                                <input name="o" placeholder="–û–±—ä–µ–∫—Ç / –ì–æ—Ä–æ–¥" required className="input-dark w-full p-4 rounded-xl font-bold border-white/5" />
                                <input name="d" type="number" defaultValue="30" className="input-dark w-full p-4 rounded-xl font-bold border-white/5" />
                            </div>
                            <button className="w-full btn-gold py-6 rounded-3xl uppercase text-[11px] font-black tracking-widest shadow-xl active:scale-95 transition-all">
                                –ó–∞–ø—É—Å—Ç–∏—Ç—å –†–æ–±–æ—Ç–∞
                            </button>
                        </form>
                        <button onClick={()=>setShowGen(true)} className="w-full mt-4 glass p-4 text-[10px] font-black uppercase tracking-widest text-blue-400 border-blue-500/20 hover:bg-blue-500/5 transition-all">
                            ü§ñ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ö–æ–¥–∞ –†–æ–±–æ—Ç–∞
                        </button>
                    </div>
                </div>

                {/* –ú–û–î–ê–õ–ö–ê –®–¢–ê–ë–û–í */}
                {showProjects && (
                    <div className="fixed inset-0 modal-overlay flex items-center justify-center p-6 z-[2000]">
                        <div className="glass w-full max-w-md p-10 border-amber-500/30">
                            <h3 className="font-black uppercase mb-8 text-amber-500 italic text-xl tracking-tighter">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –®—Ç–∞–±–∞–º–∏</h3>
                            <div className="space-y-3 mb-8 max-h-60 overflow-y-auto pr-2">
                                {projects.map((p, i) => (
                                    <div key={i} className={`p-5 rounded-2xl border transition-all flex justify-between items-center ${i===activeIdx?'border-amber-500 bg-amber-500/10 shadow-lg shadow-amber-500/5':'border-white/5 bg-black'}`}>
                                        <div onClick={()=>{setActiveIdx(i); setShowProjects(false)}} className="cursor-pointer flex-1">
                                            <div className="font-black text-sm uppercase">{p.name} {i===activeIdx && "‚úÖ"}</div>
                                            <div className="text-[8px] opacity-20 truncate mt-1 font-mono">{p.url}</div>
                                        </div>
                                        <button onClick={()=>{if(projects.length>1)setProjects(projects.filter((_,idx)=>idx!==i))}} className="text-red-500/40 hover:text-red-500 ml-4 p-2 transition-all">
                                            <i data-lucide="trash-2" size={18}></i>
                                        </button>
                                    </div>
                                ))}
                            </div>
                            <form onSubmit={e=>{e.preventDefault(); const fd=new FormData(e.target); setProjects([...projects, {name:fd.get('n'), url:fd.get('u'), techPass:fd.get('p')}]); e.target.reset();}} className="space-y-3">
                                <div className="grid grid-cols-2 gap-3">
                                    <input name="n" placeholder="–ò–º—è —à—Ç–∞–±–∞" required className="input-dark w-full p-4 rounded-xl text-xs font-bold" />
                                    <input name="p" placeholder="–¢–µ—Ö. –ø–∞—Ä–æ–ª—å" required className="input-dark w-full p-4 rounded-xl text-xs font-bold" />
                                </div>
                                <input name="u" placeholder="–°—Å—ã–ª–∫–∞ /exec –∏–∑ Google Script" required className="input-dark w-full p-4 rounded-xl text-[10px] font-mono" />
                                <button className="w-full bg-blue-600 text-white py-5 rounded-2xl font-black text-[10px] uppercase tracking-widest shadow-xl shadow-blue-600/10">–î–æ–±–∞–≤–∏—Ç—å –®—Ç–∞–±</button>
                            </form>
                            <button onClick={()=>setShowProjects(false)} className="w-full mt-6 text-[10px] font-black uppercase opacity-20 hover:opacity-100 transition-all tracking-widest">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                )}
            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>

